\doxysection{Network\+Scanner\+Service.\+cs}
\hypertarget{_network_scanner_service_8cs_source}{}\label{_network_scanner_service_8cs_source}\index{Vitzro\_OTA\_projects/Model/NetworkScannerService.cs@{Vitzro\_OTA\_projects/Model/NetworkScannerService.cs}}
\mbox{\hyperlink{_network_scanner_service_8cs}{이 파일의 문서화 페이지로 가기}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00001}00001\ \textcolor{keyword}{using\ }System;}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00002}00002\ \textcolor{keyword}{using\ }System.Collections.Generic;}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00003}00003\ \textcolor{keyword}{using\ }System.Linq;}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00004}00004\ \textcolor{keyword}{using\ }System.Net;}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00005}00005\ \textcolor{keyword}{using\ }System.Net.NetworkInformation;}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00006}00006\ \textcolor{keyword}{using\ }System.Net.Sockets;}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00007}00007\ \textcolor{keyword}{using\ }System.Threading;}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00008}00008\ \textcolor{keyword}{using\ }System.Threading.Tasks;}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00009}00009\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespace_vitzro___o_t_a__projects_1_1_model_1_1_object}{Vitzro\_OTA\_projects.Model.Object}};}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00018}00018\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespace_vitzro___o_t_a__projects_1_1_model}{Vitzro\_OTA\_projects.Model}}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00019}00019\ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00020}\mbox{\hyperlink{interface_vitzro___o_t_a__projects_1_1_model_1_1_i_network_scanner_service}{00020}}\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{interface\ }\mbox{\hyperlink{interface_vitzro___o_t_a__projects_1_1_model_1_1_i_network_scanner_service}{INetworkScannerService}}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00021}00021\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00030}\mbox{\hyperlink{interface_vitzro___o_t_a__projects_1_1_model_1_1_i_network_scanner_service_a874fad58ba53d11b04011b9c8358d13b}{00030}}\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{interface_vitzro___o_t_a__projects_1_1_model_1_1_i_network_scanner_service_a874fad58ba53d11b04011b9c8358d13b}{AutoDetectSubnetCidr}}();}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00041}\mbox{\hyperlink{interface_vitzro___o_t_a__projects_1_1_model_1_1_i_network_scanner_service_a6b67e5298db80d834ed37dc1273fac58}{00041}}\ \ \ \ \ \ \ \ \ Task<IList<HostRow>>\ \mbox{\hyperlink{interface_vitzro___o_t_a__projects_1_1_model_1_1_i_network_scanner_service_a6b67e5298db80d834ed37dc1273fac58}{ScanAsync}}(\textcolor{keywordtype}{string}\ cidr,\ \textcolor{keywordtype}{int}\ timeoutMs,\ \textcolor{keywordtype}{int}\ maxConcurrency,}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00042}00042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IProgress<(\textcolor{keywordtype}{int}\ done,\ \textcolor{keywordtype}{int}\ total)>\ progress,}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00043}00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CancellationToken\ token);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00044}00044\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00045}\mbox{\hyperlink{class_vitzro___o_t_a__projects_1_1_model_1_1_network_scanner_service}{00045}}\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_vitzro___o_t_a__projects_1_1_model_1_1_network_scanner_service}{NetworkScannerService}}\ :\ \mbox{\hyperlink{interface_vitzro___o_t_a__projects_1_1_model_1_1_i_network_scanner_service}{INetworkScannerService}}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00046}00046\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00047}\mbox{\hyperlink{class_vitzro___o_t_a__projects_1_1_model_1_1_network_scanner_service_a8d0f66e920c401689d80b57539b3970e}{00047}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{class_vitzro___o_t_a__projects_1_1_model_1_1_network_scanner_service_a8d0f66e920c401689d80b57539b3970e}{AutoDetectSubnetCidr}}()}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00048}00048\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00049}00049\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 기본\ 게이트웨이가\ 있는\ Up\ NIC\ 우선\ 선택}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (var\ nic\ \textcolor{keywordflow}{in}\ NetworkInterface.GetAllNetworkInterfaces()}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00051}00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .Where(n\ =>\ n.OperationalStatus\ ==\ OperationalStatus.Up}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ n.NetworkInterfaceType\ !=\ NetworkInterfaceType.Loopback}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ n.NetworkInterfaceType\ !=\ NetworkInterfaceType.Tunnel))}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00054}00054\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ ipProps\ =\ nic.GetIPProperties();}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ipProps.GatewayAddresses\ ==\ \textcolor{keyword}{null}\ ||\ ipProps.GatewayAddresses.Count\ ==\ 0)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00057}00057\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00058}00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ uni4\ =\ ipProps.UnicastAddresses}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00059}00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .FirstOrDefault(u\ =>\ u.Address.AddressFamily\ ==\ AddressFamily.InterNetwork);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00060}00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uni4\ ==\ \textcolor{keyword}{null})\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uni4.IPv4Mask\ ==\ \textcolor{keyword}{null})\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00062}00062\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00063}00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ prefix\ =\ MaskToPrefixLength(uni4.IPv4Mask);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00064}00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ network\ =\ GetNetworkAddress(uni4.Address,\ uni4.IPv4Mask);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00065}00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$\textcolor{stringliteral}{"{}\{network\}/\{prefix\}"{}};}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00066}00066\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00067}00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 실패\ 시\ /24로\ 기본값}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}192.168.0.0/24"{}};}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00069}00069\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00070}00070\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00071}\mbox{\hyperlink{class_vitzro___o_t_a__projects_1_1_model_1_1_network_scanner_service_a7e2f463147dfd68260a968fbb5e001b9}{00071}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ async\ Task<IList<HostRow>>\ \mbox{\hyperlink{class_vitzro___o_t_a__projects_1_1_model_1_1_network_scanner_service_a7e2f463147dfd68260a968fbb5e001b9}{ScanAsync}}(\textcolor{keywordtype}{string}\ cidr,\ \textcolor{keywordtype}{int}\ timeoutMs,\ \textcolor{keywordtype}{int}\ maxConcurrency,\ IProgress<(\textcolor{keywordtype}{int}\ done,\ \textcolor{keywordtype}{int}\ total)>\ progress,\ CancellationToken\ token)}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00072}00072\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ \ \ var\ (network,\ prefix)\ =\ ParseCidr(cidr);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00074}00074\ \ \ \ \ \ \ \ \ \ \ \ \ var\ hosts\ =\ EnumerateHosts(network,\ prefix).ToList();}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00075}00075\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ total\ =\ hosts.Count,\ done\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00076}00076\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00077}00077\ \ \ \ \ \ \ \ \ \ \ \ \ var\ results\ =\ \textcolor{keyword}{new}\ List<HostRow>(total);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \ \ \ var\ sem\ =\ \textcolor{keyword}{new}\ SemaphoreSlim(maxConcurrency\ >\ 0\ ?\ maxConcurrency\ :\ 128);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00079}00079\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00080}00080\ \ \ \ \ \ \ \ \ \ \ \ \ var\ tasks\ =\ hosts.Select(async\ ip\ =>}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ await\ sem.WaitAsync(token);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ row\ =\ await\ ProbeAsync(ip,\ timeoutMs,\ token);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lock\ (results)\ results.Add(row);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{finally}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ curr\ =\ Interlocked.Increment(ref\ done);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00091}00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ progress?.Report((curr,\ total));}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sem.Release();}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \ \ \ \}).ToList();}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00096}00096\ \ \ \ \ \ \ \ \ \ \ \ \ await\ Task.WhenAll(tasks);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ IP\ 정렬}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00098}00098\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ results.OrderBy(r\ =>\ IPToUInt(IPAddress.Parse(r.IP))).ToList();}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00099}00099\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00100}00100\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00101}00101\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ===\ 내부\ 유틸\ ===}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00108}00108\ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ (IPAddress\ network,\ \textcolor{keywordtype}{int}\ prefix)\ ParseCidr(\textcolor{keywordtype}{string}\ cidr)}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00109}00109\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 허용:\ "{}192.168.0.0/24"{}\ 또는\ "{}192.168.0.15/24"{}}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00111}00111\ \ \ \ \ \ \ \ \ \ \ \ \ var\ parts\ =\ cidr.Split(\textcolor{charliteral}{'/'});}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (parts.Length\ !=\ 2)\ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ ArgumentException(\textcolor{stringliteral}{"{}CIDR\ 형식이\ 올바르지\ 않습니다.\ 예:\ 192.168.0.0/24"{}});}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00113}00113\ \ \ \ \ \ \ \ \ \ \ \ \ var\ ip\ =\ IPAddress.Parse(parts[0]);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00114}00114\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ prefix\ =\ \textcolor{keywordtype}{int}.Parse(parts[1]);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00115}00115\ \ \ \ \ \ \ \ \ \ \ \ \ var\ mask\ =\ PrefixToMask(prefix);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00116}00116\ \ \ \ \ \ \ \ \ \ \ \ \ var\ net\ =\ GetNetworkAddress(ip,\ mask);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00117}00117\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (net,\ prefix);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00118}00118\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00119}00119\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00127}00127\ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ IEnumerable<IPAddress>\ EnumerateHosts(IPAddress\ network,\ \textcolor{keywordtype}{int}\ prefix)}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00128}00128\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00129}00129\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (prefix\ <\ 0\ ||\ prefix\ >\ 32)\ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ ArgumentOutOfRangeException(nameof(prefix));}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00130}00130\ \ \ \ \ \ \ \ \ \ \ \ \ var\ mask\ =\ PrefixToMask(prefix);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00131}00131\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00132}00132\ \ \ \ \ \ \ \ \ \ \ \ \ uint\ net\ =\ IPToUInt(GetNetworkAddress(network,\ mask));}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00133}00133\ \ \ \ \ \ \ \ \ \ \ \ \ uint\ bcast\ =\ net\ |\ \string~IPToUInt(mask);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00134}00134\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00135}00135\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ /31,/32\ 처리는\ 호스트\ 없음\ 처리}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00136}00136\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (prefix\ >=\ 31)\ yield\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00137}00137\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00138}00138\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint\ u\ =\ net\ +\ 1;\ u\ <\ bcast;\ u++)}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00139}00139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ yield\ \textcolor{keywordflow}{return}\ UIntToIP(u);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00140}00140\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00141}00141\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00150}00150\ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ async\ Task<HostRow>\ ProbeAsync(IPAddress\ ip,\ \textcolor{keywordtype}{int}\ timeoutMs,\ CancellationToken\ token)}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00151}00151\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00152}00152\ \ \ \ \ \ \ \ \ \ \ \ \ var\ ping\ =\ \textcolor{keyword}{new}\ Ping();}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00153}00153\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00154}00154\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00155}00155\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ sw\ =\ System.Diagnostics.Stopwatch.StartNew();}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00156}00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ reply\ =\ await\ ping.SendPingAsync(ip,\ timeoutMs);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00157}00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sw.Stop();}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00158}00158\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00159}00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (reply.Status\ ==\ IPStatus.Success)}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00160}00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00161}00161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ hostname\ =\ \textcolor{keyword}{null};}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00162}00162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00163}00163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00164}00164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 역방향\ DNS\ (느릴\ 수\ 있으니\ 필요\ 시\ 주석처리)}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00165}00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ entry\ =\ await\ Dns.GetHostEntryAsync(ip);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00166}00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hostname\ =\ entry?.HostName;}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00167}00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00168}00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{catch}\ \{\ \textcolor{comment}{/*\ DNS\ 실패\ 무시\ */}\ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00169}00169\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00170}00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ HostRow}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00171}00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00172}00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IP\ =\ ip.ToString(),}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00173}00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Hostname\ =\ hostname,}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LatencyMs\ =\ sw.ElapsedMilliseconds,}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00175}00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IsAlive\ =\ \textcolor{keyword}{true}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00176}00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00177}00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00178}00178\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00179}00179\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{catch}\ \{\ \textcolor{comment}{/*\ ping\ 예외\ 무시\ */}\ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00180}00180\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ HostRow}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00182}00182\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00183}00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IP\ =\ ip.ToString(),}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00184}00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Hostname\ =\ \textcolor{keyword}{null},}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00185}00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LatencyMs\ =\ \textcolor{keyword}{null},}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00186}00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IsAlive\ =\ \textcolor{keyword}{false}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00187}00187\ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00188}00188\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00189}00189\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00197}00197\ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ IPAddress\ GetNetworkAddress(IPAddress\ ip,\ IPAddress\ mask)}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00198}00198\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00199}00199\ \ \ \ \ \ \ \ \ \ \ \ \ uint\ uip\ =\ IPToUInt(ip);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00200}00200\ \ \ \ \ \ \ \ \ \ \ \ \ uint\ umask\ =\ IPToUInt(mask);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00201}00201\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ UIntToIP(uip\ \&\ umask);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00202}00202\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00203}00203\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00211}00211\ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ IPAddress\ PrefixToMask(\textcolor{keywordtype}{int}\ prefix)}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00212}00212\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00213}00213\ \ \ \ \ \ \ \ \ \ \ \ \ uint\ mask\ =\ prefix\ ==\ 0\ ?\ 0u\ :\ 0xffffffffu\ <<\ (32\ -\/\ prefix);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00214}00214\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ UIntToIP(mask);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00215}00215\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00216}00216\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00224}00224\ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ MaskToPrefixLength(IPAddress\ mask)}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00225}00225\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00226}00226\ \ \ \ \ \ \ \ \ \ \ \ \ uint\ m\ =\ IPToUInt(mask);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00227}00227\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ count\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00228}00228\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 31;\ i\ >=\ 0;\ i-\/-\/)}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00229}00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((m\ >>\ i)\ \&\ 1)\ ==\ 1)\ count++;}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00230}00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00231}00231\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ count;}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00232}00232\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00233}00233\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00241}00241\ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ uint\ IPToUInt(IPAddress\ ip)}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00242}00242\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00243}00243\ \ \ \ \ \ \ \ \ \ \ \ \ var\ bytes\ =\ ip.GetAddressBytes();\ \textcolor{comment}{//\ big-\/endian}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00244}00244\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (BitConverter.IsLittleEndian)\ Array.Reverse(bytes);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00245}00245\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ BitConverter.ToUInt32(bytes,\ 0);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00246}00246\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00247}00247\ }
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00255}00255\ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ IPAddress\ UIntToIP(uint\ value)}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00256}00256\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00257}00257\ \ \ \ \ \ \ \ \ \ \ \ \ var\ bytes\ =\ BitConverter.GetBytes(value);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00258}00258\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (BitConverter.IsLittleEndian)\ Array.Reverse(bytes);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00259}00259\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ IPAddress(bytes);}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00260}00260\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00261}00261\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_network_scanner_service_8cs_source_l00262}00262\ \}}

\end{DoxyCode}
